# Drag & Drop Timeline Guide

این راهنما توضیح می‌دهد که خط زمان تعاملی تخصیص‌ها چگونه کار می‌کند.

## مدل‌ها

- هر آیتم `Allocation` برای هر سالن به‌صورت جداگانه رندر می‌شود؛ در صورت داشتن چند سالن، آیتم در هر ردیف تکرار می‌شود.
- شناسهٔ درگ شامل نوع (`move`، `resize-start`، `resize-end`) و شناسهٔ سالن مبدأ است.
- پس از رهاسازی، سالن مقصد از شناسهٔ ردیف (`room-<id>`) استخراج می‌شود.

## جابه‌جایی و تغییر اندازه

- درگ بدنهٔ کارت باعث جابه‌جایی بازه با گام‌های ۵ دقیقه‌ای می‌شود.
- کشیدن دستگیرهٔ ابتدایی/انتهایی بازه را با گام‌های ۱۵ دقیقه‌ای تغییر می‌دهد.
- حاشیه‌های بازه به محدودهٔ انتخاب‌شده در فیلتر محدود می‌شود و حداقل طول ۱۵ دقیقه رعایت می‌شود.

## هوک‌ها و محدودیت‌ها

- از `@dnd-kit/core` برای سنسورها و Drop Targetها استفاده شده است.
- محدودکننده‌های `restrictToParentElement` و `restrictToFirstScrollableAncestor` مانع خروج آیتم از کانتینر می‌شوند.
- برای دسترسی‌پذیری، کارت با `role="button"` و کلید‌های Space/Enter انتخاب می‌شود.

## به‌روزرسانی داده

- قبل از ارسال درخواست PATCH، ظرفیت سالن در بازهٔ انتخابی بر اساس دادهٔ موجود بررسی می‌شود.
- اگر ظرفیت پیشنهادی از ظرفیت سالن بالاتر باشد، هشدار فارسی نمایش داده و کاربر باید تأیید کند.
- پس از تأیید یا عدم هشدار، فراخوانی `useUpdateAllocationMutation` انجام می‌شود و توست موفقیت نمایش داده می‌شود.

## یادداشت‌ها

- برای سالن‌های مشترک، شناسهٔ سالن مبدأ با شناسهٔ سالن مقصد جایگزین یا به آن افزوده می‌شود.
- پیام‌های خطا به کمک `resolveErrorContent` با ترجمه‌های `fa.json` نمایش داده می‌شوند.
- مسیر کامل اجزای React در `src/components/allocations/allocations-timeline.tsx` قرار دارد.
